---
title: 小程序-一个发送通知的模板
date: 2019-01-03 16:43:55
tags:
---
# 1. 自动获取access_token,并发送模板消息给自己
需要按需修改所有变量

```
submitOK: function() {
        var that = this;
        var APPID = "同下";
        var SECRET = "小程序后台找";
        var urlAccessToken = "https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=" + APPID + "&secret=" + SECRET;
        wx.request({
            url: urlAccessToken,
            header: {
                'content-type': 'application/x-www-form-urlencoded'
            },
            method: 'POST',
            success: res => {
                if (res.statusCode == '200') {
                    console.log('get token OK,')
                    var data = {
                        "keyword1": {
                            "value": '测试'
                        },
                        "keyword2": {
                            "value": 'test'
                        }
                    };
                    var token = res.data.access_token;
                    var s = {
                        "touser": wx.getStorageSync('openId'), //openid
                        "template_id": "", //申请的模板消息id,固定不变,必须
                        "page": "pages/my/my",非必须
                        "form_id": that.data.formId,//提交表单,必须填formid
                        "data": data//必须
                    }
                    var se = JSON.stringify(s)//封装
                    wx.request({
                        url: 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=' + token,
                        data: se,
                        header: {
                            'content-type': 'application/x-www-form-urlencoded'
                        },
                        method: 'POST',
                        success: res => {
                            console.log("send返回值", res.data);
                        }
                    })
                }
            }
        })
    },
```

另一个测试用的,需要手动指定access_token
```
senMessage: function() {
        var that = this;
        var form = that.data.formId.split(',');
        var APPID = "wx386e5a4da7f8fbf8";
        var SECRET = "9887b7b026a07e7d7c60808bb682226e";
        var data = {
            "keyword1": {
                "value": that.data.array[that.data.index]
            },
            "keyword2": {
                "value": that.data.bookDate + ' ' + that.data.startTime + '-' + that.data.endTime
            }
        };
        var token = "access_token"
        var s = {
            "touser": wx.getStorageSync('openId'), //openid
            "template_id": "模板消息id", //申请的模板消息id,固定不变
            "page": "pages/my/my",
            "form_id": formId,//必须填获取到的formid
            "data": data
        }
        var se = JSON.stringify(s)
        wx.request({
            url: 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=' + token,
            data: se,
            header: {
                'content-type': 'application/x-www-form-urlencoded'
            },
            method: 'POST',
            success: res => {
                console.log("send返回值", res.data);
            }
        })
    },
```